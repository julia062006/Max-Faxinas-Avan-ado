<?php

use App\Core\Database;
use App\Model\Cidade;
use App\Model\Estado;
use App\Model\Pais;

$em = Database::getEntityManager();
$cidades = $em->getRepository(Cidade::class)->findAll();
$estados = $em->getRepository(Estado::class)->findAll();
$paises = $em->getRepository(Pais::class)->findAll();
?>
<main>
    <section class="agendamento backgroundLogin">
        <div class="card">
            <div class="card-header">
                <h2 class="titulo">Cadastro</h2>
            </div>
            <div class="card-body form-cadastro">
               <form id="form" method="post" action="/cadastrar" class="row g-3 formCadastro" data-parsley-validate>

    <div class="mb-3">
        <label for="name" class="form-label">Nome:</label>
        <input type="text" id="name" class="form-control"
               name="user_nome"
               required
               data-parsley-pattern="^[A-Za-zÀ-ÖØ-öø-ÿ\s]+$"
               data-parsley-minlength="3"
               data-parsley-required-message="Preencha seu nome"
               data-parsley-pattern-message="Use apenas letras e espaços">
    </div>

    <div class="mb-3 col-md-6">
        <label class="form-label">CPF:</label>
        <input type="text" id="cpf" class="form-control cpf"
               name="user_cpf"
               required
               data-parsley-required-message="Digite seu CPF"
               data-parsley-pattern="^\d{3}\.\d{3}\.\d{3}-\d{2}$"
               data-parsley-pattern-message="Digite um CPF válido">
    </div>

    <div class="mb-3 col-md-6">
        <label class="form-label">Telefone:</label>
        <input type="text" id="telefone" class="form-control telefone"
               name="user_telefone"
               required
               data-parsley-required-message="Digite seu telefone"
               data-parsley-pattern="^\(\d{2}\)\s\d{5}-\d{4}$"
               data-parsley-pattern-message="Formato válido: (XX) XXXXX-XXXX">
    </div>

    <div class="mb-3 col-md-4">
        <label class="form-label">Cidade:</label>
        <select name="user_cidade" id="cidade" class="form-select"
                required data-parsley-required-message="Selecione a cidade">
            <option value="">Selecione</option>
            <?php foreach ($cidades as $c): ?>
                <option value="<?= $c->getId() ?>"><?= $c->getNome() ?></option>
            <?php endforeach; ?>
        </select>
    </div>

    <div class="mb-3 col-md-4">
        <label class="form-label">Estado:</label>
        <select name="user_estado" id="estado" class="form-select"
                required data-parsley-required-message="Selecione o estado">
            <option value="">Selecione</option>
            <?php foreach ($estados as $e): ?>
                <option value="<?= $e->getId() ?>"><?= $e->getNome() ?></option>
            <?php endforeach; ?>
        </select>
    </div>

    <div class="mb-3 col-md-4">
        <label class="form-label">País:</label>
        <select name="user_pais" id="pais" class="form-select"
                required data-parsley-required-message="Selecione o país">
            <option value="">Selecione</option>
            <?php foreach ($paises as $p): ?>
                <option value="<?= $p->getId() ?>"><?= $p->getNome() ?></option>
            <?php endforeach; ?>
        </select>
    </div>

    <div class="mb-3 col-md-4">
        <label for="rua" class="form-label">Rua:</label>
        <input type="text" id="rua" class="form-control" name="user_rua"
               required data-parsley-required-message="Digite sua rua">
    </div>

    <div class="mb-3 col-md-4">
        <label for="numero" class="form-label">Número:</label>
        <input type="text" id="numero" class="form-control numero"
               name="user_numero"
               required
               data-parsley-required-message="Digite o número"
               data-parsley-type="digits"
               data-parsley-type-message="Digite apenas números">
    </div>

    <div class="mb-3 col-md-4">
        <label for="bairro" class="form-label">Bairro:</label>
        <input type="text" id="bairro" class="form-control" name="user_bairro"
               required data-parsley-required-message="Digite seu bairro">
    </div>

    <div class="mb-3 col-md-6">
        <label for="email" class="form-label">E-mail:</label>
        <input type="email" id="email" class="form-control"
               name="user_email"
               required
               data-parsley-required-message="Digite seu e-mail"
               data-parsley-type="email"
               data-parsley-type-message="Digite um e-mail válido">
    </div>

    <div class="mb-3 col-md-6">
        <label for="senha" class="form-label">Senha:</label>
        <input type="password" id="senha" class="form-control"
               name="user_senha"
               required
               data-parsley-required-message="Digite sua senha"
               data-parsley-minlength="6"
               data-parsley-minlength-message="A senha deve ter pelo menos 6 caracteres">
    </div>

    <button type="submit" class="btn btn-primary">Cadastrar</button>

</form>

                <a class="linkCadastro" href="login">Voltar ao login</a>

            </div>
        </div>
    </section>
</main>